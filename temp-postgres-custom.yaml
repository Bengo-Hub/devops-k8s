## Global settings
global:
  postgresql:
    auth:
      postgresPassword: "" # Auto-generated
      username: "admin_user"
      password: "" # Auto-generated
      database: "postgres"
  defaultFips: false
  security:
    allowInsecureImages: true

fips:
  openssl: false

volumePermissions:
  enabled: false

shmVolume:
  enabled: false

## Primary PostgreSQL configuration
primary:
  image:
    registry: docker.io
    repository: codevertex/postgresql-pgvector
    tag: latest
    pullPolicy: Always
  
  podSecurityContext:
    fsGroup: 1001
    runAsUser: 1001
    runAsNonRoot: true
  
  initdb:
    scripts:
      create-admin-user.sql: |
        DO $$
        BEGIN
          IF EXISTS (SELECT FROM pg_user WHERE usename = 'admin_user') THEN
            ALTER USER admin_user WITH SUPERUSER CREATEDB;
          END IF;
        END
        $$;
      enable-pgvector.sql: |
        CREATE EXTENSION IF NOT EXISTS vector;
        GRANT USAGE ON SCHEMA public TO admin_user;
  
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  priorityClassName: db-critical
  
  persistence:
    enabled: true
    size: 20Gi
    storageClass: ""
  
  extendedConfiguration: |
    max_connections = 200
    shared_buffers = 512MB
    effective_cache_size = 1536MB
    work_mem = 2621kB
    maintenance_work_mem = 128MB
    checkpoint_completion_target = 0.9
    wal_buffers = 16MB
    default_statistics_target = 100
    random_page_cost = 1.1
    effective_io_concurrency = 200
    min_wal_size = 1GB
    max_wal_size = 4GB
  
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6

metrics:
  enabled: true
  image:
    registry: quay.io
    repository: prometheuscommunity/postgres-exporter
    tag: v0.15.0
    pullPolicy: IfNotPresent
  serviceMonitor:
    enabled: true
    namespace: infra
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"

networkPolicy:
  enabled: false

