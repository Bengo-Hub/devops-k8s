## Bitnami PostgreSQL Helm Chart Values
## Custom image with pgvector extension

## Global settings
global:
  postgresql:
    auth:
      postgresPassword: "" # Leave empty, will be auto-generated
      username: "admin_user"
      password: ""         # Leave empty, will be auto-generated
      database: "postgres"
  # FIPS compliance settings (required for newer chart versions)
  defaultFips: false
  # Allow custom images (required for codevertex/postgresql-pgvector)
  security:
    allowInsecureImages: true

# FIPS OpenSSL configuration
fips:
  openssl: false

## Primary PostgreSQL configuration
primary:
  ## Custom PostgreSQL image with pgvector extension
  ## Uses custom image built via GitHub Actions workflow
  image:
    registry: docker.io
    repository: codevertex/postgresql-pgvector
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: "2Gi"  # Increased - priority database for all services
      cpu: "500m"
    limits:
      memory: "4Gi"
      cpu: "2000m"
  priorityClassName: db-critical
  
  persistence:
    enabled: true
    size: 20Gi  # Adjust based on data size
    storageClass: ""  # Use default storage class
  
  ## PostgreSQL tuning
  extendedConfiguration: |
    max_connections = 200
    shared_buffers = 512MB
    effective_cache_size = 1536MB
    work_mem = 2621kB
    maintenance_work_mem = 128MB
    checkpoint_completion_target = 0.9
    wal_buffers = 16MB
    default_statistics_target = 100
    random_page_cost = 1.1
    effective_io_concurrency = 200
    min_wal_size = 1GB
    max_wal_size = 4GB
  
  ## Health checks
  livenessProbe:
    enabled: true
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 6

## Read replicas (optional, for scaling reads)
readReplicas:
  replicaCount: 0  # Set to 1+ for read replicas
  ## Use custom PostgreSQL image with pgvector extension (same as primary)
  image:
    registry: docker.io
    repository: codevertex/postgresql-pgvector
    tag: latest
    pullPolicy: IfNotPresent
  resources:
    requests:
      memory: "512Mi"
      cpu: "250m"
    limits:
      memory: "2Gi"
      cpu: "1000m"
  priorityClassName: db-critical
  
  persistence:
    enabled: true
    size: 20Gi

## Metrics for Prometheus
metrics:
  enabled: true
  serviceMonitor:
    enabled: true
    namespace: monitoring
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "256Mi"
      cpu: "200m"
  # Leave image config to use chart defaults

## Backup configuration
backup:
  enabled: false  # Set to true if using built-in backup
  cronjob:
    schedule: "0 2 * * *"  # Daily at 2 AM
    storage:
      size: 10Gi

## Network policy (restrict access)
networkPolicy:
  enabled: false  # Set to true for production
  allowExternal: false
  explicitNamespacesSelector: {}

